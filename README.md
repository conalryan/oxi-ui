# Canon

Canonical Front-End library generated by AI - A modern monorepo using Bun + Vite + OXC.

## Overview

Canon is a frontend monorepo that provides:

- **@canon/core** - Core TypeScript library with authentication, feature flags, permissions, and utilities
- **@canon/web-components** - Lit-based web components with React and Angular wrappers

## Quick Start

```bash
# Install dependencies
bun install

# Build all packages
bun run build

# Run tests
bun run test

# Run tests with coverage
bun run test:coverage

# Lint code
bun run lint

# Format code
bun run format
```

## Packages

### @canon/core

Core utilities library with tree-shakable exports:

```typescript
// Import specific modules
import { isAuthorized } from '@canon/core/authentication';
import { isEnabled } from '@canon/core/feature-flags';
import { hasPermission } from '@canon/core/permissions';
import { debounce, throttle } from '@canon/core/utils';

// Or import everything
import { isAuthorized, isEnabled, hasPermission, debounce } from '@canon/core';
```

#### Authentication

```typescript
import { isAuthorized } from '@canon/core/authentication';

const session = {
  userId: 'user-123',
  roles: ['admin', 'user'],
  expiresAt: '2026-12-31T23:59:59Z',
  permissions: ['read', 'write']
};

const result = isAuthorized(session, {
  requiredRoles: ['admin'],
  requiredPermissions: ['read']
});

if (result.authorized) {
  // User has access
}
```

#### Feature Flags

```typescript
import { initializeFeatureFlags, isEnabled } from '@canon/core/feature-flags';

initializeFeatureFlags([
  { id: 'new-dashboard', name: 'New Dashboard', enabled: true },
  { id: 'beta-feature', name: 'Beta', enabled: true, rolloutPercentage: 50 }
]);

if (isEnabled('new-dashboard')) {
  // Show new dashboard
}

if (isEnabled('beta-feature', { userId: 'user-123' })) {
  // Show beta feature (50% rollout)
}
```

### @canon/web-components

Lit-based web components with framework wrappers:

#### Web Components (Vanilla JS/HTML)

```html
<script type="module">
  import '@canon/web-components';
</script>

<canon-button variant="primary" size="medium">Click me</canon-button>

<canon-text-field
  label="Email"
  type="email"
  placeholder="Enter your email"
  required
></canon-text-field>
```

#### React

```tsx
import { CanonButton, CanonTextField } from '@canon/web-components/react';

function App() {
  const [email, setEmail] = useState('');

  return (
    <>
      <CanonButton variant="primary" onClick={() => console.log('clicked')}>
        Submit
      </CanonButton>

      <CanonTextField
        label="Email"
        type="email"
        value={email}
        onInput={(e) => setEmail(e.detail.value)}
      />
    </>
  );
}
```

#### Angular

```typescript
import { CanonComponentsModule } from '@canon/web-components/angular';

@NgModule({
  imports: [CanonComponentsModule],
})
export class AppModule {}
```

```html
<canon-button-wrapper variant="primary" (canonClick)="handleClick($event)">
  Submit
</canon-button-wrapper>

<canon-text-field-wrapper
  label="Email"
  type="email"
  [value]="email"
  (canonInput)="onEmailInput($event)"
>
</canon-text-field-wrapper>
```

## Development

### Build a specific package

```bash
bun run build:core
bun run build:web-components
```

### Test a specific package

```bash
bun run test:core
bun run test:web-components
```

### Package Scripts

Each package supports:
- `build` - Build the package with Vite
- `test` - Run tests with Bun
- `test:coverage` - Run tests with coverage
- `clean` - Remove dist and coverage directories
- `typecheck` - Run TypeScript type checking

## Architecture

### Monorepo Structure

```
canon/
├── package.json          # Root workspace config
├── bunfig.toml          # Bun configuration
├── tsconfig.json        # Base TypeScript config
├── packages/
│   ├── core/            # @canon/core
│   │   ├── src/
│   │   │   ├── authentication/
│   │   │   ├── feature-flags/
│   │   │   ├── permissions/
│   │   │   └── utils/
│   │   └── vite.config.ts
│   └── web-components/  # @canon/web-components
│       ├── src/
│       │   ├── button/
│       │   ├── text-field/
│       │   ├── react/
│       │   └── angular/
│       └── vite.config.ts
└── prompts/             # AI generation prompts
```

### Technology Stack

- **Runtime**: [Bun](https://bun.sh) - Fast JavaScript runtime and package manager
- **Bundler**: [Vite](https://vitejs.dev) - Next-generation frontend tooling
- **Linting**: [OXLint](https://oxc-project.github.io/docs/guide/usage/linter.html) - Fast Rust-based linter
- **Web Components**: [Lit](https://lit.dev) - Simple, fast web components
- **Testing**: Bun test runner with built-in coverage

### Key Features

- ✅ Independent package versioning, building, testing, and publishing
- ✅ Caching - only necessary tasks run
- ✅ Parallel task execution with dependency resolution
- ✅ Tree-shakable exports for optimal bundle size
- ✅ Minification and production-ready builds
- ✅ 90%+ code coverage target
- ✅ TypeScript with strict mode
- ✅ Framework-agnostic web components
- ✅ React and Angular wrapper components

## Documentation

- [Workspace Recommendations](./prompts/WORKSPACE_RECOMMENDATIONS.md)
- [Modern Tooling Recommendations](./prompts/MODERN_TOOLING_RECOMMENDATIONS.md)

## License

MIT
